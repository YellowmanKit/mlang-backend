{"version":3,"sources":["../../../src/main/routers/app.js"],"names":["AppRouter","app","init","upload","get","temp","storage","req","res","next","type","params","append","getAppend","fileName","name","filePath","path","join","download","err","console","log","post","array","headers","filenames","i","files","length","filename","splted","split","splice","fs","move","json","result","status","version","Router"],"mappings":";;;;;;;;AAAA;;;;AACA;;AACA;;;;AAEA;;;;;;;;;;;;;;IAEMA,S;;;AAEJ,qBAAYC,GAAZ,EAAgB;AAAA;;AAAA,sHACRA,GADQ;;AAEd,UAAKA,GAAL,GAAWA,GAAX;AACA,UAAKC,IAAL;AAHc;AAIf;;;;2BAEK;AAAA;;AACJ,UAAMD,MAAM,KAAKA,GAAjB;AACA,UAAME,SAASF,IAAIG,GAAJ,CAAQ,QAAR,CAAf;AACA,UAAMC,OAAOJ,IAAIG,GAAJ,CAAQ,MAAR,CAAb;AACA,UAAME,UAAUL,IAAIG,GAAJ,CAAQ,SAAR,CAAhB;;AAEAH,UAAIG,GAAJ,CAAQ,uBAAR,EAAiC,UAACG,GAAD,EAAKC,GAAL,EAASC,IAAT,EAAgB;AAC/C,YAAMC,OAAOH,IAAII,MAAJ,CAAWD,IAAxB;AACA,YAAME,SAAS,OAAKC,SAAL,CAAeH,IAAf,CAAf;AACA,YAAMI,WAAWP,IAAII,MAAJ,CAAWI,IAA5B;AACA,YAAMC,WAAWC,eAAKC,IAAL,CAAUZ,OAAV,EAAkBM,MAAlB,EAAyBE,QAAzB,CAAjB;;AAEA;;AAEA,eAAON,IAAIW,QAAJ,CAAaH,QAAb,EAAsBF,QAAtB,EAA+B,UAACM,GAAD,EAAO;AAC3C,cAAGA,GAAH,EAAO;AAAEC,oBAAQC,GAAR,CAAY,qBAAZ;AAAqC;AAC/C,SAFM,CAAP;AAGD,OAXD;;AAaArB,UAAIsB,IAAJ,CAAS,SAAT,EAAmBpB,OAAOqB,KAAP,CAAa,OAAb,CAAnB,EAA0C,UAACjB,GAAD,EAAKC,GAAL,EAAUC,IAAV,EAAiB;AACzD;;AAEA,YAAMC,OAAOH,IAAIkB,OAAJ,CAAYf,IAAzB;AACA,YAAIE,SAAS,OAAKC,SAAL,CAAeH,IAAf,CAAb;AACA,YAAIgB,YAAY,EAAhB;;AAEA,aAAI,IAAIC,IAAE,CAAV,EAAYA,IAAEpB,IAAIqB,KAAJ,CAAUC,MAAxB,EAA+BF,GAA/B,EAAmC;AACjC,cAAIG,WAAWvB,IAAIqB,KAAJ,CAAUD,CAAV,EAAaG,QAA5B;AACA,cAAMC,SAASD,SAASE,KAAT,CAAe,GAAf,CAAf;;AAEAN,oBAAUO,MAAV,CAAiB,CAAjB,EAAmB,CAAnB,EAAqBH,QAArB;;AAEA,cAAGpB,SAAS,MAAZ,EAAmB;AACfE,qBAASmB,OAAO,CAAP,MAAc,cAAd,GAA8B,OAAKlB,SAAL,CAAe,UAAf,CAA9B,GAA0D,OAAKA,SAAL,CAAe,WAAf,CAAnE;AACH;;AAEDqB,4BAAGC,IAAH,CAAQ9B,OAAOyB,QAAf,EAAyBxB,UAAUM,MAAV,GAAmBkB,QAA5C,EAAsD,UAACV,GAAD,EAAQ;AAC1D,gBAAGA,GAAH,EAAO;AAAEC,sBAAQC,GAAR,CAAYF,GAAZ;AAAmB;AAC/B,WAFD;AAGD;;AAED,eAAOZ,IAAI4B,IAAJ,CAAS;AACdC,kBAAQ,SADM;AAEdX,qBAAWA;AAFG,SAAT,CAAP;AAID,OA1BD;;AA4BAzB,UAAIG,GAAJ,CAAQ,GAAR;AAAA,2EAAa,iBAAOG,GAAP,EAAWC,GAAX,EAAeC,IAAf;AAAA;AAAA;AAAA;AAAA;AAAA,mDACJD,IAAI8B,MAAJ,CAAW,GAAX,EAAgBF,IAAhB,CAAqB;AAC1BG,6BAASA;AADiB,mBAArB,CADI;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAb;;AAAA;AAAA;AAAA;AAAA;AAKD;;;;EA5DqBC,gB;;kBAgETxC,S","file":"app.js","sourcesContent":["import Router from './Router';\r\nimport {version} from '../../../package.json';\r\nimport path from 'path';\r\n\r\nimport fs from 'fs-extra';\r\n\r\nclass AppRouter extends Router{\r\n\r\n  constructor(app){\r\n    super(app);\r\n    this.app = app;\r\n    this.init();\r\n  }\r\n\r\n  init(){\r\n    const app = this.app;\r\n    const upload = app.get('upload');\r\n    const temp = app.get('temp');\r\n    const storage = app.get('storage');\r\n\r\n    app.get('/download/:type/:name', (req,res,next)=>{\r\n      const type = req.params.type;\r\n      const append = this.getAppend(type);\r\n      const fileName = req.params.name;\r\n      const filePath = path.join(storage,append,fileName);\r\n\r\n      //console.log('Donwloading ' + filePath)\r\n\r\n      return res.download(filePath,fileName,(err)=>{\r\n        if(err){ console.log('File download error'); }\r\n      });\r\n    });\r\n\r\n    app.post('/upload',upload.array('files'), (req,res, next)=>{\r\n      //console.log('Uploaded ', req.files);\r\n\r\n      const type = req.headers.type;\r\n      var append = this.getAppend(type);\r\n      var filenames = [];\r\n\r\n      for(var i=0;i<req.files.length;i++){\r\n        var filename = req.files[i].filename;\r\n        const splted = filename.split('-');\r\n\r\n        filenames.splice(0,0,filename);\r\n\r\n        if(type === 'card'){\r\n            append = splted[1] === 'cardIcon.png'? this.getAppend('cardIcon'): this.getAppend('langAudio');\r\n        }\r\n\r\n        fs.move(temp + filename, storage + append + filename, (err)=> {\r\n            if(err){ console.log(err); }\r\n        });\r\n      }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        filenames: filenames\r\n      })\r\n    });\r\n\r\n    app.get('/', async (req,res,next)=>{\r\n      return res.status(200).json({\r\n        version: version\r\n      })\r\n    });\r\n  }\r\n\r\n}\r\n\r\nexport default AppRouter;\r\n"]}