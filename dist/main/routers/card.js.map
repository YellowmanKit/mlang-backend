{"version":3,"sources":["../../../src/main/routers/card.js"],"names":["ObjectId","require","Types","CardRouter","app","init","post","req","res","cardId","body","data","userId","err","card","like","Like","console","log","json","result","updatedCard","Card","findOneAndUpdate","_id","$set","studentRead","new","cardToUpdate","langs","lang","langsId","i","length","Lang","key","text","audio","upsert","splice","icon","updatedLangs","cards","featuredCount","profile","studentProject","updatedCards","grade","comment","audioComment","resubmitted","count","author","Profile","belongTo","updatedProfile","_cards","_profiles","findById","findOne","_langs","j","find","profiles","next","project","createdCard","createdLang","cardCount","create","createdLangs","createdLangsId","isTeacher","StudentProject","student","$push","Project","studentProjects","some","sp","equals","resubmitCard","updatedStudentProject","updatedProject","Router"],"mappings":"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","file":"card.js","sourcesContent":["import Router from './Router';\r\nimport path from 'path';\r\nvar ObjectId = require('mongoose').Types.ObjectId;\r\n//import multer from 'multer';\r\n\r\nimport fs from 'fs-extra';\r\nimport to from '../../to';\r\n\r\nimport Card from '../../models/Card.js';\r\nimport Lang from '../../models/Lang.js';\r\nimport Project from '../../models/Project.js';\r\nimport StudentProject from '../../models/StudentProject.js';\r\nimport Profile from '../../models/Profile.js';\r\n\r\nimport Like from '../../models/Like.js';\r\n\r\nclass CardRouter extends Router {\r\n\r\n  constructor(app){\r\n    super(app);\r\n    this.app = app;\r\n    this.init();\r\n  }\r\n\r\n  init(){\r\n    const app = this.app;\r\n\r\n    app.post('/card/like', async(req,res)=>{\r\n      const cardId = req.body.data.cardId;\r\n      const userId = req.body.data.userId;\r\n      let err, card, like;\r\n      [err, card, like] = await Like.card(cardId, userId);\r\n\r\n      if(err){ console.log('failed to like card'); return res.json({ result: 'failed to like card'}) }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        updatedCard: card\r\n      })\r\n    })\r\n\r\n    app.post('/card/studentRead', async(req,res)=>{\r\n      const cardId = req.body.data.cardId;\r\n      let err, card;\r\n      [err, card] = await(to(Card.findOneAndUpdate({_id: cardId},{$set:{\r\n        studentRead: true\r\n      }}, {new: true})));\r\n      if(err || card === null){ console.log('failed to update card'); return res.json({ result: 'failed to update card'}) }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        updatedCard: card\r\n      })\r\n    })\r\n\r\n    app.post('/card/edit', async(req, res)=>{\r\n      const cardToUpdate = req.body.data.card;\r\n      var langs = req.body.data.langs;\r\n      //console.log(cardToUpdate);\r\n      //console.log(langs);\r\n      let err, lang, card;\r\n      var langsId = [];\r\n      for(var i=0;i<langs.length;i++){\r\n        [err, lang] = await(to(Lang.findOneAndUpdate({_id: langs[i]._id},{$set:{\r\n          key: langs[i].key,\r\n          text: langs[i].text,\r\n          audio: langs[i].audio,\r\n          card: cardToUpdate._id\r\n        }}, {new: true, upsert: true})));\r\n        if(err || lang === null){ console.log('failed to update lang'); return res.json({ result: 'failed to update lang'}) }\r\n        //console.log(lang);\r\n        langs[i]._id = lang._id;\r\n        langsId.splice(0,0,langs[i]._id);\r\n      }\r\n\r\n      [err, card] = await(to(Card.findOneAndUpdate({_id: cardToUpdate._id},{$set:{\r\n        langs: langsId,\r\n        icon: cardToUpdate.icon\r\n      }}, {new: true})));\r\n      if(err || card === null){ console.log('failed to update card'); return res.json({ result: 'failed to update card'}) }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        updatedLangs: langs,\r\n        updatedCard: card\r\n      })\r\n    });\r\n\r\n    app.post('/card/grade', async(req, res)=>{\r\n      const data = req.body.data;\r\n      const cards = data.cards;\r\n      //console.log(cards);\r\n      let err, card, featuredCount, profile, studentProject;\r\n      var updatedCards = [];\r\n      for(var i=0;i<cards.length;i++){\r\n        [err, card] = await to(Card.findOneAndUpdate({_id: cards[i]}, { $set: {\r\n          grade: cards[i].grade,\r\n          comment: cards[i].comment,\r\n          audioComment: cards[i].audioComment,\r\n          resubmitted: false,\r\n          studentRead: false\r\n        }}, {new: true}));\r\n        if(err || card === null){ console.log('no such card!'); return res.json({ result: 'failed' })}\r\n        updatedCards.splice(0,0,card);\r\n      }\r\n\r\n      if(cards.length > 0){\r\n        [err, featuredCount] = await to(Card.count({author: cards[0].author, grade: 'featured'}));\r\n        if(err || featuredCount === null){ console.log('err on getting featuredCount!'); }\r\n\r\n        [err, profile] = await to(Profile.findOneAndUpdate({belongTo: cards[0].author}, { $set:{\r\n          featuredCount: featuredCount\r\n        }}, {new: true}))\r\n        if(err || profile === null){ console.log('err on updating featuredCount!'); }\r\n      }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        updatedCards: updatedCards,\r\n        updatedProfile: profile\r\n      })\r\n    });\r\n\r\n    app.post('/card/getMultiple', async(req, res)=>{\r\n      const cards = req.body.data.cards;\r\n      //console.log(cards);\r\n      let err, card, langs, profile;\r\n      var _cards = [];\r\n      var _profiles = [];\r\n      for(var i=0;i<cards.length;i++){\r\n        [err, card] = await to(Card.findById(cards[i]));\r\n        if(err || card === null){ console.log('no such card!'); return res.json({ result: 'failed' })}\r\n        _cards.splice(0,0,card);\r\n\r\n        [err, profile] = await to(Profile.findOne({belongTo: card.author}));\r\n        if(err || profile === null){ return res.json({ result: 'failed' })}\r\n        _profiles.splice(0,0, profile);\r\n      }\r\n\r\n      var _langs = [];\r\n      for(var j=0;j<_cards.length;j++){\r\n        [err, langs] = await to(Lang.find({card: cards[j]}));\r\n        if(err || langs === null || langs.length === 0){ console.log('card hv no lang!'); return res.json({ result: 'failed' })}\r\n        _langs = [..._langs, ...langs]\r\n      }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        cards: _cards,\r\n        langs: _langs,\r\n        profiles: _profiles\r\n      })\r\n    });\r\n\r\n    app.post('/card/add', async(req, res, next)=>{\r\n      const data = req.body.data;\r\n      var card = data.card;\r\n      var langs = data.langs;\r\n\r\n      let err, project, studentProject, createdCard, createdLang, cardCount, profile;\r\n\r\n      //console.log(card);\r\n\r\n      [err, createdCard] = await to(Card.create(card))\r\n      if(err || createdCard === null){ console.log(err); return res.json({ result: \"failed to create card\" });}\r\n\r\n      var createdLangs = []\r\n      var createdLangsId = [];\r\n      for(var i=0;i<langs.length;i++){\r\n        langs[i].card = createdCard._id;\r\n        [err, createdLang] = await to(Lang.create(langs[i]));\r\n        if(err || createdLang === null){ return res.json({ result: \"failed to create lang\" });}\r\n        createdLangs.splice(0,0,createdLang);\r\n        createdLangsId.splice(0,0,createdLang._id);\r\n      }\r\n\r\n      [err, createdCard] = await to(Card.findOneAndUpdate({_id: createdCard._id}, { $set: {\r\n        langs: createdLangsId\r\n      }}, {new: true}))\r\n      if(err || createdCard === null){ return res.json({ result: \"failed to update langs in card\" });}\r\n\r\n      if(data.isTeacher){\r\n        [err, studentProject] = await to(StudentProject.findOneAndUpdate({student: card.author, project: data.project }, {$push: {\r\n          cards: createdCard._id\r\n        }}, {upsert: true, new: true}))\r\n        if(err || studentProject === null){ return res.json({ result: \"failed to create student project\" });}\r\n\r\n        [err, project] = await to(Project.findById(studentProject.project));\r\n        if(err || project === null){ return res.json({ result: \"failed to find project\" });}\r\n\r\n        if(!project.studentProjects.some(sp=>{return sp.equals(studentProject._id)}) ){\r\n          [err, project] = await to(Project.findOneAndUpdate({_id: studentProject.project}, { $push:{\r\n            studentProjects: studentProject._id\r\n          }}, {new: true}));\r\n          if(err || project === null){ return res.json({ result: \"failed to update project\" });}\r\n        }\r\n      }else{\r\n        [err, studentProject] = await to(StudentProject.findOneAndUpdate({_id: card.studentProject._id}, { $push: {\r\n          cards: createdCard._id\r\n        }}, {new: true}))\r\n        if((err || createdCard === null) && !data.isTeacher){ return res.json({ result: \"failed to find student project\" });}\r\n      }\r\n\r\n      [err, cardCount] = await to(Card.count({author: card.author}));\r\n      if(!err && cardCount){\r\n        [err, profile] = await to(Profile.findOneAndUpdate({belongTo: card.author}, { $set:{\r\n          cardCount: cardCount\r\n        }}, {new: true}))\r\n      }\r\n\r\n      let resubmitCard;\r\n      if(data.resubmitCard){\r\n        [err, resubmitCard] = await to(Card.findOneAndUpdate({_id: data.resubmitCard}, {$set:{resubmitted: true}}));\r\n        if(err || !resubmitCard){ return res.json({ result: \"failed to update resubmitCard!\" });}\r\n      }\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        card: createdCard,\r\n        langs: createdLangs,\r\n        updatedStudentProject: studentProject,\r\n        updatedProject: project,\r\n        updatedProfile: profile,\r\n        updatedCard: resubmitCard,\r\n      })\r\n\r\n    })\r\n\r\n  }\r\n\r\n}\r\n\r\nexport default CardRouter;\r\n"]}