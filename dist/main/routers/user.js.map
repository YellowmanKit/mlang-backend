{"version":3,"sources":["../../../src/main/routers/user.js"],"names":["ObjectId","require","Types","UserRouter","app","init","mongoose","connect","db","connection","post","req","res","next","userId","body","data","console","log","err","updatedUser","User","findOneAndUpdate","id","$set","type","new","json","result","profiles","admins","getProfilesByUsers","existedUser","findOne","pw","_id","toString","email","get","headers","resetPassword","acquireNewAccount","schools","courses","subjects","projects","studentProjects","cards","langs","user","profile","getUserAndProfile","teacherProfiles","Course","getJoined","joinedCourses","Subject","getByCourses","joinedSubjects","Project","getBySubjects","joinedProjects","StudentProject","getByProjects","joinedStudentProjects","Card","getByStudentProjects","joinedCards","getTeaching","teachingCourses","teachingSubjects","teachingProjects","teachingStudentProjects","teachingCards","School","getByUser","supervisingSchools","getByType","adminUsers","Profile","profilesId","Lang","getByCards","langsId","Router"],"mappings":"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","file":"user.js","sourcesContent":["import Router from './Router';\r\nimport path from 'path';\r\nimport mongoose from 'mongoose';\r\nvar ObjectId = require('mongoose').Types.ObjectId;\r\nimport to from '../../to';\r\n\r\nimport Query from '../../models/Query.js';\r\nimport User from '../../models/User.js';\r\nimport Profile from '../../models/Profile.js';\r\nimport School from '../../models/School.js';\r\nimport Course from '../../models/Course.js';\r\nimport Subject from '../../models/Subject.js';\r\nimport Project from '../../models/Project.js';\r\nimport StudentProject from '../../models/StudentProject.js';\r\nimport Card from '../../models/Card.js';\r\nimport Lang from '../../models/Lang.js';\r\n\r\nclass UserRouter extends Router {\r\n\r\n  constructor(app){\r\n    super(app);\r\n    this.app = app;\r\n    this.init();\r\n  }\r\n\r\n  init(){\r\n    const app = this.app;\r\n    mongoose.connect('mongodb://localhost/mlang');\r\n    var db = mongoose.connection;\r\n\r\n    app.post('/user/addAdmin', async(req, res, next)=>{\r\n      const userId = req.body.data.userId;\r\n      console.log(userId);\r\n      let err, updatedUser;\r\n      [err, updatedUser] = await to(User.findOneAndUpdate({id: userId},{$set:{type:'admin'}},{new: true}))\r\n      if(err){ console.log(err); return res.json({ result: 'failed'})}\r\n\r\n      let profiles = [];\r\n      let admins = [];\r\n      [err, profiles, admins] = await User.getProfilesByUsers([updatedUser]);\r\n      if(err){ console.log(err); return res.json({ result: 'failed'})}\r\n\r\n      return res.json({\r\n        result: 'success',\r\n        updatedUser: updatedUser,\r\n        profiles: profiles,\r\n        admins: admins\r\n      });\r\n    });\r\n\r\n    app.post('/user/update', async(req, res, next)=>{\r\n      const data = req.body.data;\r\n      let err, existedUser;\r\n      [err, existedUser] = await to(User.findOne({id: data.id, pw: data.pw}));\r\n      if(err){ console.log(err); return res.json({ result: 'failed'})}\r\n      if(existedUser && existedUser._id.toString() !== data._id){ console.log('user id/pw already used'); return res.json({ result: 'failed'}) }\r\n\r\n      User.findOneAndUpdate({_id: data._id}, { $set:{\r\n        type: data.type,\r\n        id: data.id,\r\n        pw: data.pw,\r\n        email: data.email\r\n      }}, {new: true}, (err, updatedUser)=>{\r\n        return res.json({\r\n          result: (err || !updatedUser)? 'failed':'success' ,\r\n          updatedUser: updatedUser\r\n        });\r\n      });\r\n\r\n    });\r\n\r\n    app.get('/user/resetPassword/', async (req, res, next)=>{\r\n      const email = req.headers.email;\r\n\r\n      User.resetPassword(email, result=>{\r\n        return res.json({ result: result });\r\n      });\r\n    });\r\n\r\n    app.get('/user/getNewAccount/', (req, res, next)=>{\r\n      const email = req.headers.email;\r\n\r\n      User.acquireNewAccount(email, result=>{\r\n        return res.json({ result: result });\r\n      });\r\n    });\r\n\r\n    app.get('/user/login/', async (req, res, next)=>{\r\n      const id = req.headers.id;\r\n      const pw = req.headers.pw;\r\n\r\n      let profiles = [];\r\n      let schools = [];\r\n      let courses = [];\r\n      let subjects = [];\r\n      let projects = [];\r\n      let studentProjects = [];\r\n      let cards = [];\r\n      let langs = [];\r\n\r\n      let err, data, user, profile;\r\n      [err, user, profile] = await User.getUserAndProfile(id, pw);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      profiles = [profile];\r\n\r\n      let teacherProfiles;\r\n      [err, data, teacherProfiles] = await Course.getJoined(profile.joinedCourses);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      courses = [...courses, ...data];\r\n      profiles = [...profiles, ...teacherProfiles];\r\n\r\n      var joinedSubjects;\r\n      [err, data, joinedSubjects] = await Subject.getByCourses(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      subjects = [...subjects, ...data];\r\n\r\n      var joinedProjects;\r\n      [err, data, joinedProjects] = await Project.getBySubjects(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      projects = [...projects, ...data];\r\n\r\n      var joinedStudentProjects;\r\n      [err, data, joinedStudentProjects] = await StudentProject.getByProjects(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      studentProjects = [...studentProjects, ...data];\r\n\r\n      var joinedCards;\r\n      [err, data, joinedCards] = await Card.getByStudentProjects(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      cards = [...cards, ...data];\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n      var teachingCourses;\r\n      [err, data, teachingCourses] = await Course.getTeaching(user._id);\r\n      if(err){ return res.json({ result: \"failed\" });}\r\n\r\n      courses = [...courses, ...data];\r\n\r\n      var teachingSubjects;\r\n      [err, data, teachingSubjects] = await Subject.getByCourses(data);\r\n      if(err){ return res.json({ result: \"failed\" });}\r\n\r\n      subjects = [...subjects, ...data];\r\n\r\n      var teachingProjects;\r\n      [err, data, teachingProjects] = await Project.getBySubjects(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      projects = [...projects, ...data];\r\n\r\n      var teachingStudentProjects;\r\n      [err, data, teachingStudentProjects] = await StudentProject.getByProjects(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      studentProjects = [...studentProjects, ...data];\r\n\r\n      var teachingCards;\r\n      [err, data, teachingCards] = await Card.getByStudentProjects(data);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      cards = [...cards, ...data];\r\n\r\n      var supervisingSchools;\r\n      [err, data, supervisingSchools] = await School.getByUser(user._id, profile);\r\n      if(err){ return res.json({ result: \"failed\" });}\r\n\r\n      schools = [...schools, ...data];\r\n\r\n      var adminUsers;\r\n      [err, data, adminUsers] = await User.getByType('admin');\r\n\r\n      var admins = [];\r\n\r\n      [err, data, admins] = await User.getProfilesByUsers(data);\r\n      if(err){ return res.json({ result: \"failed\" });}\r\n\r\n      profiles = [...profiles, ...data];\r\n\r\n\r\n\r\n\r\n\r\n      var profilesId;\r\n      [err, data, profilesId] = await Profile.getByStudentProjects(studentProjects);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      profiles = [...profiles, ...data];\r\n\r\n      var langsId;\r\n      [err, data, langsId] = await Lang.getByCards(cards);\r\n      if(err){ return res.json({ result: \"failed\" }); }\r\n\r\n      langs = [...langs, ...data];\r\n\r\n      return res.json({\r\n        result: \"success\",\r\n        user: user,\r\n        profile: profile,\r\n        profiles: profiles,\r\n\r\n        admins: admins,\r\n        supervisingSchools: supervisingSchools,\r\n\r\n        teachingCourses: teachingCourses,\r\n        joinedCourses: profile.joinedCourses,\r\n\r\n        teachingSubjects: teachingSubjects,\r\n        joinedSubjects: joinedSubjects,\r\n\r\n        teachingProjects: teachingProjects,\r\n        joinedProjects: joinedProjects,\r\n\r\n        teachingStudentProjects: teachingStudentProjects,\r\n        joinedStudentProjects: joinedStudentProjects,\r\n\r\n        teachingCards: teachingCards,\r\n        joinedCards: joinedCards,\r\n\r\n        schools: schools,\r\n        courses: courses,\r\n        subjects: subjects,\r\n        projects: projects,\r\n        studentProjects: studentProjects,\r\n        cards: cards,\r\n        langs: langs\r\n      })\r\n    });\r\n\r\n  }\r\n\r\n}\r\n\r\nexport default UserRouter;\r\n"]}