{"version":3,"sources":["../../src/models/Course.js"],"names":["ObjectId","mongoose","Schema","Types","courseSchema","teacher","type","required","icon","String","title","createdAt","Date","default","endDate","code","joinedStudents","subjects","Course","module","exports","model","leaveCourse","data","cb","err","courseToLeave","updatedProfile","findOneAndUpdate","$pull","userId","new","Profile","belongTo","joinedCourses","_id","joinCourse","courseToJoin","$push","addCourse","newCourse","course","newCode","i","randomString","generate","length","charset","findOne","create","console","log"],"mappings":"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","file":"Course.js","sourcesContent":["import mongoose from 'mongoose';\r\nimport randomString from'randomstring';\r\nimport to from'../to';\r\n\r\nimport Profile from './Profile';\r\n\r\nvar ObjectId = mongoose.Schema.Types.ObjectId;\r\nvar courseSchema = mongoose.Schema({\r\n  teacher: {\r\n    type: ObjectId,\r\n    required: true\r\n  },\r\n  icon: {\r\n    type: String\r\n  },\r\n  title: {\r\n    type: String\r\n  },\r\n  createdAt: {\r\n    type: Date,\r\n    default: new Date()\r\n  },\r\n  endDate: {\r\n    type: Date,\r\n    default: new Date()\r\n  },\r\n  code: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  joinedStudents: [ObjectId],\r\n  subjects: [ObjectId]\r\n})\r\n\r\nvar Course = module.exports = mongoose.model('course',courseSchema);\r\n\r\nmodule.exports.leaveCourse = async (data, cb)=>{\r\n  let err, courseToLeave, updatedProfile;\r\n\r\n  [err, courseToLeave] = await to(Course.findOneAndUpdate({code: data.code}, { $pull: {\r\n    joinedStudents: data.userId\r\n  }}, {new: true}))\r\n  if(err || courseToLeave === null){ cb('failed'); };\r\n\r\n  [err, updatedProfile] = await to(Profile.findOneAndUpdate({belongTo: data.userId}, { $pull: {\r\n    joinedCourses: courseToLeave._id\r\n  }}, {new: true}))\r\n  if(err || updatedProfile === null){ cb('failed'); };\r\n\r\n  cb('success', courseToLeave, updatedProfile)\r\n}\r\n\r\nmodule.exports.joinCourse = async (data, cb)=>{\r\n  let err, courseToJoin, updatedProfile;\r\n\r\n  [err, courseToJoin] = await to(Course.findOneAndUpdate({code: data.code}, { $push: {\r\n    joinedStudents: data.userId\r\n  }}, {new: true}))\r\n  if(err || courseToJoin === null){ cb('failed'); };\r\n\r\n  [err, updatedProfile] = await to(Profile.findOneAndUpdate({belongTo: data.userId}, { $push: {\r\n    joinedCourses: courseToJoin._id\r\n  }}, {new: true}))\r\n  if(err || updatedProfile === null){ cb('failed'); };\r\n\r\n  cb('success', courseToJoin, updatedProfile)\r\n}\r\n\r\nmodule.exports.addCourse = async (newCourse, cb)=>{\r\n  let err, course;\r\n\r\n  var newCode = '';\r\n  for(var i=0;i<99;i++){\r\n    newCode = randomString.generate({\r\n      length: 5,\r\n      charset: 'ABCDEFGHJKMNOPQRSTUVWXYZ1234567890'\r\n    });\r\n\r\n    [err,course] = await to(Course.findOne({code: newCode}));\r\n    if(!err && course === null){ break; };\r\n  }\r\n\r\n  newCourse['code'] = newCode;\r\n\r\n  [err, course] = await to(Course.create(newCourse));\r\n  if(err){ cb('failed'); console.log(err); return; }\r\n\r\n  //console.log(course)\r\n  cb('success', course)\r\n}\r\n"]}